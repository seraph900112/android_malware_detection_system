package com.example.malware_detection.SVM;

import android.content.Context;
import android.content.pm.ActivityInfo;
import android.content.pm.PackageInfo;
import android.content.pm.PackageManager;
import android.content.pm.PermissionInfo;
import android.content.pm.ProviderInfo;
import android.util.Log;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.LinkedList;
import java.util.List;

public class PermissionExtractor {

    public static String[] extractPermissions(Context context, String apkFilePath) {
        PackageManager pm = context.getPackageManager();
        PackageInfo packageInfo = pm.getPackageArchiveInfo(apkFilePath,
                PackageManager.GET_PERMISSIONS | PackageManager.GET_PROVIDERS | PackageManager.GET_RECEIVERS);
        List<String> features = new LinkedList<>();
        if (packageInfo != null) {
            ProviderInfo[] providerInfos = packageInfo.providers;
            ActivityInfo[] receiverInfos = packageInfo.receivers;
            if (packageInfo.requestedPermissions != null) {
                features.addAll(Arrays.asList(packageInfo.requestedPermissions));
            }
            if (providerInfos != null) {
                for (ProviderInfo providerInfo : packageInfo.providers) {
                    features.add(providerInfo.name);
                }
            }
            if (receiverInfos != null) {
                for (ActivityInfo activityInfo : packageInfo.receivers) {
                    features.add(activityInfo.name);
                }
            }
        }
        Log.d("test123", String.valueOf(features.size()));
        String[] featuresArray = new String[features.size()];
        features.toArray(featuresArray);
        return featuresArray;
    }
}